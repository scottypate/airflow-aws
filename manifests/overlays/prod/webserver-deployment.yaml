kind: Deployment
apiVersion: apps/v1
metadata:
  name: airflow-webserver
  labels:
    tier: airflow
    component: webserver
    release: airflow
spec:
  template:
    spec:
      initContainers:
        - name: wait-for-airflow-migrations
          imagePullPolicy: Always
          image: "063789902345.dkr.ecr.us-west-2.amazonaws.com/airflow:prod"
      containers:
        # Always run the main webserver container.
        - name: webserver
          imagePullPolicy: Always
          volumeMounts:
            - name: airflow-config
              mountPath: "/opt/airflow/airflow.cfg"
              subPath: airflow.cfg
              readOnly: true
          image: "063789902345.dkr.ecr.us-west-2.amazonaws.com/airflow:prod"
      volumes:
        - name: airflow-config
          configMap:
            name: airflow-config
